---
format_version: '13'
default_step_lib_source: https://github.com/bitrise-io/bitrise-steplib.git
project_type: other
workflows:
  primary:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8:
        inputs:
        - clone_into_dir: "$BITRISE_SOURCE_DIR"
    - nvm@1:
        inputs:
        - node_version: 20.18.0
    - npm@1:
        inputs:
        - command: ci
    - npm@1:
        inputs:
        - command: run build
    - deploy-to-bitrise-io@2:
        inputs:
        - zip_name: dist
        - is_compress: true
        - deploy_path: dist
    triggers:
      push:
      - branch: bitrise
      pull_request:
      - source_branch: "*"
  android:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8:
        inputs:
        - clone_into_dir: "$BITRISE_SOURCE_DIR"
    - nvm@1:
        inputs:
        - node_version: 20.18.0
    - npm@1:
        inputs:
        - command: ci
    - npm@1:
        inputs:
        - command: run build
    - script@1:
        inputs:
        - content: |-
            #!/usr/bin/env bash
            set -e
            set -o pipefail
            set -x

            npx cap sync
    - install-missing-android-tools@3:
        inputs:
        - gradlew_path: "$BITRISE_SOURCE_DIR/android/gradlew"
    - android-build@1:
        inputs:
        - project_location: "$BITRISE_SOURCE_DIR/android"
        - module: app
        - variant: release
        - build_type: aab
    - sign-apk@2:
        inputs:
        - android_app: "$BITRISE_AAB_PATH"
        - verbose_log: true
    - deploy-to-bitrise-io@2:
        inputs:
        - deploy_path: "$BITRISE_SIGNED_AAB_PATH"
    triggers:
      push:
      - branch: bitrise
      pull_request:
      - source_branch: "*"
  ios:
    steps:
    - activate-ssh-key@4:
        run_if: '{{getenv "SSH_RSA_PRIVATE_KEY" | ne ""}}'
    - git-clone@8:
        inputs:
        - clone_into_dir: "$BITRISE_SOURCE_DIR"
    - nvm@1:
        inputs:
        - node_version: 20.18.0
    - npm@1:
        inputs:
        - command: ci
    - npm@1:
        inputs:
        - command: run build
    - script@1:
        inputs:
        - content: |-
            #!/usr/bin/env bash
            set -e
            set -o pipefail
            set -x

            npx cap sync ios
    - xcode-archive@5:
        inputs:
        - project_path: "$BITRISE_SOURCE_DIR/ios/App/App.xcodeproj"
        - scheme: App
        - distribution_method: app-store
    - deploy-to-bitrise-io@2:
        inputs:
        - deploy_path: "$BITRISE_IPA_PATH"
        - zip_name: build.ipa
    triggers:
      push:
      - branch: bitrise
      pull_request:
      - source_branch: "*"
meta:
  bitrise.io:
    stack: osx-xcode-16.1.x-edge
    machine_type_id: g2-m1.8core
